<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Açık Hava Basıncı (Toriçelli Deneyi)</title>
    <style>
        :root{
            --safe-pad: clamp(16px, 3vw, 48px);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Header */
        .header {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 16px;
            border-bottom: 2px solid rgba(125, 211, 252, 0.6);
        }
        .header h1 {
            font-size: 30px;
            font-weight: bold;
            text-align: center;
            color: #2563eb;
        }

        /* Main Container */
        .main-container {
            position: relative;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        /* Background Image */
        .background-image {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover; background-position: center;
            background-repeat: no-repeat;
            transition: background-image 1s ease-in-out;
            filter: brightness(0.9);
        }

        /* Gradient Overlay */
        .gradient-overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            opacity: 0.4;
            transition: background 1s ease-in-out;
        }

        /* Content Container */
        .content {
            position: relative;
            height: 100%;
            z-index: 10;
            background: rgba(255, 255, 255, 0.2);
            padding-inline: var(--safe-pad);
        }

        /* Control Panel */
        .control-panel {
            position: absolute;
            top: 24px;
            left: calc(var(--safe-pad));
            z-index: 20;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.8);
            padding: 16px;
            min-width: 280px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .control-section { margin-bottom: 16px; }
        .control-section:last-child { margin-bottom: 0; }
        .section-title { font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #374151; }

        .altitude-buttons {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 8px; margin-bottom: 16px;
        }
        .tube-type-buttons { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }

        .altitude-btn, .tube-type-btn {
            padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px;
            background: white; color: #374151; font-size: 14px; font-weight: 500;
            cursor: pointer; transition: all 0.2s;
        }
        .altitude-btn:hover, .tube-type-btn:hover { background: #f3f4f6; }
        .altitude-btn.active, .tube-type-btn.active { background: #2563eb; border-color: #2563eb; color: white; }
        .altitude-btn:disabled, .tube-type-btn:disabled { opacity: .5; cursor: not-allowed; }
        .start-btn {
            width: 100%; padding: 12px 16px; background: #2563eb; color: white; border: none; border-radius: 6px;
            font-size: 16px; font-weight: 600; cursor: pointer; transition: all .2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .start-btn:hover { background: #1d4ed8; }

        .pressure-display { padding-top: 12px; border-top: 1px solid #e5e7eb; }
        .pressure-value { font-size: 24px; font-weight: bold; color: #2563eb; }
        .info-section { padding-top: 12px; border-top: 1px solid #e5e7eb; display: flex; align-items: center; gap: 8px; }
        .info-value { font-size: 16px; font-weight: 500; }

        /* Simulation Area (masaüstünde JS ile scale) */
        .simulation-area {
            position: absolute;
            left: 50%;
            bottom: 2px;
            transform: translateX(-50%);   /* JS buraya scale ekler (>=768px) */
            transform-origin: bottom center;
            padding: 0 16px;
            will-change: transform;
        }

        /* Mercury Basin */
        .mercury-basin { position: relative; }

        .glass-container {
            width: 256px; height: 112px;
            background: rgba(59, 130, 246, 0.2);
            border: 4px solid rgba(59, 130, 246, 0.4);
            border-radius: 12px; margin: 0 auto;
            backdrop-filter: blur(4px); position: relative;
        }
        .mercury-in-basin {
            position: absolute; bottom: 0; left: 0; right: 0; height: 80px;
            background: linear-gradient(to top, #4b5563, #6b7280);
            border-radius: 0 0 8px 8px;
        }
        .mercury-in-basin::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: rgba(75,85,99,.5); }
        .mercury-label { position: absolute; bottom: 8px; right: 12px; color: white; font-size: 18px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,.8); }

        /* Tube Assembly */
        .tube-assembly {
            position: absolute; left: 40%; bottom: 56px;
            transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center;
        }

        /* Glass Tube */
        .glass-tube {
            position: relative; width: 48px; height: 800px;
            background: linear-gradient(to right, rgba(125, 211, 252, .4) 0%, rgba(255,255,255,.6) 50%, rgba(125,211,252,.4) 100%);
            border: 2px solid rgba(125, 211, 252, .6); border-radius: 20px 20px 0 0;
            backdrop-filter: blur(4px);
            box-shadow: 0 8px 32px rgba(59,130,246,.2);
            overflow: hidden; transition: all .5s ease;
        }
        .glass-tube.thicker { width: 72px; border-width: 3px; }
        .glass-tube.diagonal { transform: skewX(15deg) translateX(-90px); width: 48px; }
        .tube-assembly.diagonal-active .pressure-equation { transform: translateX(-120px); }

        /* Mercury Column */
        .mercury-column { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top,#4b5563,#6b7280,#9ca3af); transition: height 2s ease-out; }
        .mercury-column.fast { transition: height .3s ease-out; }
        .mercury-shine { position: absolute; top: 0; left: 0; right: 0; height: 100%; background: linear-gradient(to right,transparent,rgba(255,255,255,.3),transparent); }

        /* Vacuum Space */
        .vacuum-space { position: absolute; top: 0; left: 0; right: 0; background: rgba(125,211,252,.2); }

        /* Ruler */
        .ruler {
            position: absolute; right: -64px; top: 0; width: 40px; height: 800px;
            background: linear-gradient(to bottom,#fde68a,#f59e0b);
            border: 2px solid #d97706; border-radius: 8px; box-shadow: 0 4px 15px rgba(217,119,6,.3);
        }
        .scale-mark { position: absolute; left: 0; right: 0; border-top: 1px solid rgba(146,64,14,.5); }
        .scale-number { position: absolute; left: 100%; margin-left: 4px; margin-top: -15px; font-size: 15px; font-weight: bold; color: #2563eb; -webkit-text-stroke: 2px white; paint-order: stroke fill; }

        /* Red Indicator Line */
        .pressure-indicator { position: absolute; left: 0; right: 0; height: 2px; background: #ef4444; transition: top 1s ease-out; z-index: 5; }
        .pressure-value-display { position: absolute; right: 100%; margin-right: 40px; top: -15px; background: #ef4444; color: #fff; padding: 6px 12px; border-radius: 8px; font-size: 14px; font-weight: bold; white-space: nowrap; box-shadow: 0 4px 12px rgba(239,68,68,.3); }

        /* Pressure Equation */
        .pressure-equation { position: absolute; left: -112px; top: 50%; transform: translateY(-50%); }
        .equation-text { font-size: 20px; font-weight: bold; color: #2563eb; -webkit-text-stroke: 2px white; paint-order: stroke fill; }
        .equation-label { font-size: 12px; font-weight: 600; color: #374151; -webkit-text-stroke: 1px white; paint-order: stroke fill; margin-top: 4px; }

        /* Footer Info */
        .footer-info {
            position: absolute; bottom: 16px; right: var(--safe-pad);
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 12px 16px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,.15);
        }
        .footer-text { font-size: 12px; color: #6b7280; }

        /* Background Gradients */
        .bg-sea    { background: linear-gradient(to bottom, #60a5fa, #3b82f6, #dbeafe); }
        .bg-low    { background: linear-gradient(to bottom, #3b82f6, #2563eb, #bfdbfe); }
        .bg-medium { background: linear-gradient(to bottom, #2563eb, #1d4ed8, #93c5fd); }
        .bg-high   { background: linear-gradient(to bottom, #1e40af, #1e3a8a, #60a5fa); }

        .hidden { display: none !important; }
        .play-icon { width: 16px; height: 16px; fill: currentColor; }

        /* ===== MOBİL (eski görünüm korunur) ===== */
        @media (max-width: 768px) {
            .header h1 { font-size: 20px; }
            .control-panel {
                position: fixed; left: 8px; top: 70px;
                min-width: 200px; max-width: 220px; padding: 10px;
                max-height: calc(100vh - 160px); font-size: 12px;
            }
            .section-title { font-size: 12px; }
            .altitude-btn, .tube-type-btn { padding: 6px 10px; font-size: 12px; }
            .start-btn { padding: 10px 14px; font-size: 14px; }
            .pressure-value { font-size: 20px; }
            .info-value { font-size: 14px; }

            /* Mobilde sabit, JS scale UYGULANMAZ */
            .simulation-area { 
                transform: translateX(-20%) scale(0.7);
                transform-origin: bottom center; 
                right: 0; 
            }
            .footer-info { bottom: 8px; left: 8px; right: auto; padding: 8px 12px; }
            .footer-text { font-size: 10px; }
            .pressure-equation { left: auto; right: -60px; }
            .equation-text { font-size: 16px; }
            .equation-label { font-size: 10px; }
            .tube-assembly.diagonal-active .pressure-equation { transform: none; }
            .glass-tube.diagonal { transform: skewX(8deg) translateX(-40px); width: 48px; }
        }

        @media (max-width: 480px) {
            .control-panel { min-width: 180px; max-width: 190px; padding: 8px; }
            .simulation-area { transform: translateX(-15%) scale(0.55); right: -20px; }
            .altitude-buttons { grid-template-columns: 1fr; }
            .section-title { font-size: 11px; }
            .glass-tube.diagonal { transform: skewX(8deg) translateX(-40px); width: 48px; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>Açık Hava Basıncı (Toriçelli Deneyi)</h1>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <div class="background-image" id="backgroundImage"></div>
        <div class="gradient-overlay" id="gradientOverlay"></div>

        <div class="content">
            <!-- Control Panel -->
            <div class="control-panel">
                <div class="control-section">
                    <h3 class="section-title">Deney Tüpü Çeşidi</h3>
                    <div class="tube-type-buttons">
                        <button class="tube-type-btn active" data-tube-type="normal">Normal Tüp</button>
                        <button class="tube-type-btn" data-tube-type="thicker">Daha Kalın Tüp</button>
                        <button class="tube-type-btn" data-tube-type="diagonal">Çarpraz Tüp</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3 class="section-title">Yükseklik (m)</h3>
                    <div class="altitude-buttons">
                        <button class="altitude-btn active" data-altitude="0">0 m</button>
                        <button class="altitude-btn" data-altitude="105">105 m</button>
                        <button class="altitude-btn" data-altitude="210">210 m</button>
                        <button class="altitude-btn" data-altitude="315">315 m</button>
                    </div>
                </div>

                <div class="control-section" id="startSection">
                    <button class="start-btn" id="startBtn">
                        <svg class="play-icon" viewBox="0 0 24 24"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg>
                        Ölçüme Başla
                    </button>
                </div>

                <div class="control-section pressure-display hidden" id="pressureSection" style="display: none;">
                    <h3 class="section-title" id="pressureTitle">Basınç</h3>
                    <div class="pressure-value" id="pressureValue"></div>
                </div>

                <div class="control-section info-section">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#ef4444"><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0Z"/></svg>
                    <div>
                        <h3 class="section-title" style="margin-bottom: 0;">Sıcaklık</h3>
                        <p class="info-value">0°C (Sabit)</p>
                    </div>
                </div>

                <div class="control-section info-section">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#3b82f6"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
                    <div>
                        <h3 class="section-title" style="margin-bottom: 0;">Nem</h3>
                        <p class="info-value">Sabit</p>
                    </div>
                </div>

                <div class="control-section info-section">
                    <div>
                        <h3 class="section-title" style="margin-bottom: 0;">Mevcut Yükseklik</h3>
                        <div style="font-size: 20px; font-weight: bold; color: #2563eb;" id="currentAltitude">0 metre</div>
                    </div>
                </div>
            </div>

            <!-- Simulation Area -->
            <div class="simulation-area" id="simRoot">
                <div class="mercury-basin">
                    <div class="glass-container">
                        <div class="mercury-in-basin"></div>
                        <div class="mercury-label">civa</div>
                    </div>

                    <div class="tube-assembly">
                        <div class="glass-tube" id="glassTube">
                            <div class="mercury-column" id="mercuryColumn" style="height: 800px;">
                                <div class="mercury-shine"></div>
                            </div>
                            <div class="vacuum-space" id="vacuumSpace" style="height: 0px;"></div>
                        </div>

                        <div class="ruler" id="ruler"></div>

                        <div class="pressure-equation">
                            <div class="equation-text">P₀ = P</div>
                            <div class="equation-label">Atmosfer Basıncı</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-info">
                <p class="footer-text">Yükseklik arttıkça atmosfer basıncı azalır</p>
            </div>
        </div>
    </div>

    <script>
        const PX_PER_CM = 8;
        const TUBE_CM = 100;
        const TUBE_HEIGHT = TUBE_CM * PX_PER_CM; // 800px

        const altitudePresets = [
            { altitude: 0,   pressure: 76, background: 'bg-sea',    image: 'label/sea.png'    },
            { altitude: 105, pressure: 75, background: 'bg-low',    image: 'label/low.png'    },
            { altitude: 210, pressure: 74, background: 'bg-medium', image: 'label/medium.png' },
            { altitude: 315, pressure: 73, background: 'bg-high',   image: 'label/high.png'   },
        ];

        const backgroundImage = document.getElementById('backgroundImage');
        const gradientOverlay = document.getElementById('gradientOverlay');
        const altitudeButtons = document.querySelectorAll('.altitude-btn');
        const tubeTypeButtons = document.querySelectorAll('.tube-type-btn');
        const startBtn = document.getElementById('startBtn');
        const startSection = document.getElementById('startSection');
        const pressureSection = document.getElementById('pressureSection');
        const pressureValue = document.getElementById('pressureValue');
        const currentAltitude = document.getElementById('currentAltitude');
        const mercuryColumn = document.getElementById('mercuryColumn');
        const vacuumSpace = document.getElementById('vacuumSpace');
        const ruler = document.getElementById('ruler');
        const glassTube = document.getElementById('glassTube');
        const simRoot = document.getElementById('simRoot');

        let selectedPreset = altitudePresets[0];
        let measurementStarted = false;
        let selectedTubeType = 'normal';

        function createRulerMarks() {
            ruler.innerHTML = '';
            for (let cm = 0; cm <= 100; cm += 10) {
                const mark = document.createElement('div');
                mark.className = 'scale-mark';
                mark.style.top = (TUBE_HEIGHT - cm * PX_PER_CM) + 'px';

                const number = document.createElement('span');
                number.className = 'scale-number';
                number.textContent = cm;
                mark.appendChild(number);
                ruler.appendChild(mark);
            }
            const indicator = document.createElement('div');
            indicator.className = 'pressure-indicator';
            indicator.id = 'pressureIndicator';

            const valueDisplay = document.createElement('div');
            valueDisplay.className = 'pressure-value-display';
            valueDisplay.id = 'pressureValueDisplay';
            valueDisplay.textContent = '100 cm';

            indicator.appendChild(valueDisplay);
            ruler.appendChild(indicator);
        }

        function updateDisplay() {
            backgroundImage.style.backgroundImage = `url(${selectedPreset.image})`;
            gradientOverlay.className = `gradient-overlay ${selectedPreset.background}`;
            currentAltitude.textContent = `${selectedPreset.altitude} metre`;

            const displayPressure = measurementStarted ? selectedPreset.pressure : 100;
            const mercuryHeightPx = displayPressure * PX_PER_CM;
            const vacuumHeightPx  = TUBE_HEIGHT - mercuryHeightPx;

            mercuryColumn.style.height = mercuryHeightPx + 'px';
            vacuumSpace.style.height   = vacuumHeightPx + 'px';

            const indicator = document.getElementById('pressureIndicator');
            const valueDisplay = document.getElementById('pressureValueDisplay');
            if (indicator && valueDisplay) {
                indicator.style.top = vacuumHeightPx + 'px';
                valueDisplay.textContent = `${displayPressure} cm`;
            }

            fitSimulation();
        }

        tubeTypeButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (measurementStarted) return;
                selectedTubeType = button.dataset.tubeType;

                tubeTypeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const tubeAssembly = document.querySelector('.tube-assembly');

                glassTube.className = 'glass-tube';
                tubeAssembly.classList.remove('diagonal-active');

                if (selectedTubeType === 'thicker') {
                    glassTube.classList.add('thicker');
                } else if (selectedTubeType === 'diagonal') {
                    glassTube.classList.add('diagonal');
                    tubeAssembly.classList.add('diagonal-active');
                }

                pressureSection.classList.add('hidden');
                pressureSection.style.display = 'none';

                fitSimulation();
            });
        });

        altitudeButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (measurementStarted) return;
                const altitude = parseInt(button.dataset.altitude);
                const preset = altitudePresets.find(p => p.altitude === altitude);
                if (!preset) return;

                selectedPreset = preset;
                measurementStarted = false;

                tubeTypeButtons.forEach(btn => btn.disabled = false);
                altitudeButtons.forEach(btn => btn.disabled = false);

                altitudeButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                startSection.classList.remove('hidden');
                pressureSection.classList.add('hidden');
                pressureSection.style.display = 'none';

                mercuryColumn.classList.add('fast');
                updateDisplay();
                setTimeout(() => mercuryColumn.classList.remove('fast'), 300);
            });
        });

        startBtn.addEventListener('click', () => {
            measurementStarted = true;
            startBtn.disabled = true;
            startBtn.innerHTML = `<svg class="play-icon" viewBox="0 0 24 24"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg> Ölçülüyor...`;

            tubeTypeButtons.forEach(btn => btn.disabled = true);
            altitudeButtons.forEach(btn => btn.disabled = true);

            pressureValue.textContent = `${selectedPreset.pressure} cm·Hg`;
            pressureSection.classList.remove('hidden');
            pressureSection.style.display = 'block';

            updateDisplay();

            setTimeout(() => {
                measurementStarted = false;
                tubeTypeButtons.forEach(btn => btn.disabled = false);
                altitudeButtons.forEach(btn => btn.disabled = false);
                startBtn.disabled = false;
                startBtn.innerHTML = `<svg class="play-icon" viewBox="0 0 24 24"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg> Ölçüme Başla`;
            }, 2000);
        });

        /* ===== Masaüstü için otomatik ölçekleme; mobilde kapalı ===== */
        const DESIGN_H = 960;  // px
        const DESIGN_W = 1100; // px

        function fitSimulation() {
            // <768px ise mobil düzen: JS hiç dokunmasın
            if (window.innerWidth < 768) {
                simRoot.style.transform = '';      // CSS’teki mobil transform geçerli
                simRoot.style.marginRight = '';
                return;
            }

            const content = document.querySelector('.content');
            const panel   = document.querySelector('.control-panel');

            const safePad = parseFloat(getComputedStyle(content).paddingLeft) || 0;

            const availW = content.clientWidth - panel.offsetWidth - safePad - 24;
            const availH = content.clientHeight - 16;

            let s = Math.min(1, availW / DESIGN_W, availH / DESIGN_H);

            simRoot.style.transformOrigin = 'bottom center';
            simRoot.style.transform = `translateX(-50%) scale(${s})`;

            if (window.innerWidth >= 1600) {
                const extraRight = Math.max(0, (content.clientWidth - panel.offsetWidth) - (DESIGN_W * s) - safePad - 80);
                simRoot.style.marginRight = (extraRight < 80 ? 80 : 0) + 'px';
            } else {
                simRoot.style.marginRight = '0px';
            }
        }

        function init() {
            createRulerMarks();
            pressureSection.style.display = 'none';
            pressureValue.textContent = '';
            updateDisplay();
            fitSimulation();
        }

        window.addEventListener('resize', fitSimulation);
        window.addEventListener('orientationchange', fitSimulation);
        window.addEventListener('load', init);
        init();
    </script>
</body>
</html>
